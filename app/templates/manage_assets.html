<div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
    <div class="sm:flex sm:items-start">
        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
            <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">
                Manage Assets for Template: {{ template.name }}
            </h3>
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Upload New Asset
                </label>
                <form id="upload-asset-form" hx-post="/api/v1/branding/upload" hx-target="#assets-list" hx-swap="innerHTML" hx-encoding="multipart/form-data" hx-on:htmx:after-request="hideModal()">
                    <input type="hidden" name="template_id" value="{{ template.id }}">
                    <div class="mb-4">
                        <input type="file" name="file" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                    </div>
                    <div class="mb-4">
                        <label for="file-type" class="block text-sm font-medium text-gray-700 mb-1">
                            File Type
                        </label>
                        <select name="file_type" id="file-type" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                            <option value="logo">Logo</option>
                            <option value="favicon">Favicon</option>
                            <option value="theme">Theme CSS</option>
                            <option value="manifest">Web Manifest</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <button type="submit"
                        class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:text-sm">
                        Upload Asset
                    </button>
                </form>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Current Assets
                </label>
                <div id="assets-list" class="border border-gray-200 rounded-md p-4">
                    {% if assets|length > 0 %}
                    <div class="grid grid-cols-1 gap-4">
                        {% for asset in assets %}
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-md">
                            <div class="flex items-center space-x-3">
                                {% if asset.file_type == 'logo' or asset.file_type == 'favicon' %}
                                <img src="/customization{{ asset.file_path }}" alt="{{ asset.file_name }}"
                                     class="w-8 h-8 object-cover rounded" onerror="this.style.display='none'">
                                {% elif asset.file_type == 'theme' %}
                                <i class="fas fa-palette text-blue-500 text-lg"></i>
                                {% elif asset.file_type == 'manifest' %}
                                <i class="fas fa-mobile-alt text-green-500 text-lg"></i>
                                {% else %}
                                <i class="fas fa-file text-gray-500 text-lg"></i>
                                {% endif %}
                                <div>
                                    <div class="text-sm font-medium text-gray-900">{{ asset.file_name }}</div>
                                    <div class="text-sm text-gray-500">{{ asset.file_type }}</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                {% if asset.file_type in ['logo', 'favicon', 'theme'] %}
                                <button onclick="previewAsset('{{ asset.file_path }}', '{{ asset.file_type }}', '{{ asset.file_name }}')"
                                    class="inline-flex items-center p-2 border border-transparent rounded-md text-blue-600 hover:text-blue-800"
                                    title="Preview">
                                    <i class="fas fa-eye"></i>
                                </button>
                                {% endif %}
                                <button onclick="downloadAsset('/customization{{ asset.file_path }}', '{{ asset.file_name }}')"
                                    class="inline-flex items-center p-2 border border-transparent rounded-md text-green-600 hover:text-green-800"
                                    title="Download">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button hx-delete="/api/v1/branding/assets/{{ asset.id }}" hx-target="#assets-list" hx-swap="innerHTML"
                                    class="inline-flex items-center p-2 border border-transparent rounded-md text-red-600 hover:text-red-800"
                                    title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-gray-500 text-center py-4">No assets uploaded yet</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
    <button type="button" onclick="hideModal()"
        class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
        Close
    </button>
</div>

<!-- Asset Preview Modal -->
<div id="preview-modal" class="fixed inset-0 z-50 hidden overflow-y-auto">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 transition-opacity" aria-hidden="true">
            <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
        </div>
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div class="sm:flex sm:items-start">
                    <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4" id="preview-title">
                            Asset Preview
                        </h3>
                        <div id="preview-content" class="mb-4">
                            <!-- Preview content will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button type="button" onclick="hidePreviewModal()"
                    class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Function to preview asset
    function previewAsset(filePath, fileType, fileName) {
        const modal = document.getElementById('preview-modal');
        const title = document.getElementById('preview-title');
        const content = document.getElementById('preview-content');

        title.textContent = `Preview: ${fileName}`;

        if (fileType === 'logo' || fileType === 'favicon') {
            content.innerHTML = `<img src="/customization${filePath}" alt="${fileName}" class="max-w-full max-h-96 mx-auto">`;
        } else if (fileType === 'theme') {
            // For CSS themes, show a sample styled element
            content.innerHTML = `
                <div class="border rounded p-4">
                    <p class="text-sm text-gray-600 mb-2">CSS Theme Preview:</p>
                    <link rel="stylesheet" href="/customization${filePath}">
                    <div class="sample-content p-4 border rounded bg-gray-50">
                        <h4 class="text-lg font-bold">Sample Heading</h4>
                        <p class="text-sm">This is how the theme might affect text styling.</p>
                        <button class="px-3 py-1 bg-blue-500 text-white rounded mt-2">Sample Button</button>
                    </div>
                </div>
            `;
        } else {
            content.innerHTML = `<p class="text-gray-500">Preview not available for this file type.</p>`;
        }

        modal.classList.remove('hidden');
    }

    // Function to hide preview modal
    function hidePreviewModal() {
        document.getElementById('preview-modal').classList.add('hidden');
    }

    // Function to download asset
    function downloadAsset(url, filename) {
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // Close preview modal when clicking outside
    document.addEventListener('click', function (event) {
        const modal = document.getElementById('preview-modal');
        if (modal && !modal.classList.contains('hidden') && event.target === modal) {
            hidePreviewModal();
        }
    });

    // Close preview modal with Escape key
    document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
            hidePreviewModal();
        }
    });
</script>